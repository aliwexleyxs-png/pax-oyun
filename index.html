<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>tarihsenaryosu_ai - D√ºnya Sim√ºlasyonu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet (d√ºnya haritasƒ± i√ßin) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      padding: 12px;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1200px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 50px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 10px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #111827;
    }

    .logo-area {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-main {
      font-weight: 700;
      font-size: 1rem;
    }

    .logo-sub {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .time-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.85rem;
    }

    .date-display {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .time-buttons {
      display: flex;
      gap: 4px;
    }

    .time-btn {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s, border-color 0.15s, transform 0.08s;
    }

    .time-btn span.icon {
      font-size: 0.9rem;
    }

    .time-btn:hover {
      border-color: #4f46e5;
      background: #111827;
      transform: translateY(-1px);
    }

    .main {
      display: flex;
      flex: 1;
      gap: 10px;
      min-height: 480px;
    }

    .left-panel {
      flex: 1.4;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #111827;
      background: #020617;
      display: flex;
      flex-direction: column;
    }

    #map {
      flex: 1;
      min-height: 380px;
    }

    .map-footer {
      padding: 6px 10px;
      font-size: 0.75rem;
      border-top: 1px solid #111827;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #020617;
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card {
      background: #020617;
      border-radius: 12px;
      border: 1px solid #111827;
      padding: 10px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: #a5b4fc;
      background: #020617;
    }

    .country-name {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .country-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .country-stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
      font-size: 0.78rem;
      margin-bottom: 6px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .stat-label {
      color: #9ca3af;
    }

    .stat-value {
      font-weight: 500;
    }

    .country-actions {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .mini-btn {
      flex: 1;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
      color: #9ca3af;
      font-size: 0.75rem;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
    }

    .mini-btn:hover {
      border-color: #4b5563;
      background: #030712;
    }

    /* Chat */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: 280px;
    }

    .chat-messages {
      flex: 1;
      border-radius: 8px;
      border: 1px solid #111827;
      background: #020617;
      padding: 8px;
      font-size: 0.78rem;
      overflow-y: auto;
      margin-bottom: 6px;
    }

    .chat-msg {
      margin-bottom: 4px;
    }

    .chat-msg.me {
      text-align: right;
    }

    .chat-msg span.role {
      font-weight: 600;
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .chat-msg span.text {
      display: inline-block;
      margin-top: 1px;
    }

    .chat-msg.bot span.text {
      color: #e5e7eb;
    }

    .chat-input-row {
      display: flex;
      gap: 4px;
    }

    .chat-input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
      padding: 6px 9px;
      color: #e5e7eb;
      font-size: 0.8rem;
      outline: none;
    }

    .chat-input-row input:focus {
      border-color: #4f46e5;
    }

    .chat-input-row button {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #4f46e5;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #e5e7eb;
      font-size: 0.78rem;
      cursor: pointer;
      transition: transform 0.08s, box-shadow 0.1s;
    }

    .chat-input-row button:hover {
      box-shadow: 0 8px 18px rgba(79,70,229,0.5);
      transform: translateY(-1px);
    }

    .chat-input-row button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    @media (max-width: 900px) {
      .main {
        flex-direction: column;
      }
      .left-panel {
        min-height: 260px;
      }
      #map {
        min-height: 260px;
      }
    }

    @media (max-width: 600px) {
      .time-controls {
        flex-direction: column;
        align-items: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-bar">
      <div class="logo-area">
        <div class="logo-main">tarihsenaryosu_ai</div>
        <div class="logo-sub">d√ºnya senaryosu ‚Ä¢ prototip aray√ºz</div>
      </div>
      <div class="time-controls">
        <div class="date-display" id="dateDisplay">
          Tarih y√ºkleniyor...
        </div>
        <div class="time-buttons">
          <button class="time-btn" id="btnWeek">
            <span class="icon">‚ñ∂</span>
            <span>+1 hafta</span>
          </button>
          <button class="time-btn" id="btnMonth">
            <span class="icon">‚ñ∂‚ñ∂</span>
            <span>+1 ay</span>
          </button>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="left-panel">
        <div id="map"></div>
        <div class="map-footer">
          <span>üåç D√ºnya haritasƒ± aktif ‚Äî tƒ±klayarak bir b√∂lge se√ß.</span>
          <span id="coordsLabel">Se√ßim yok</span>
        </div>
      </div>

      <div class="right-panel">
        <div class="card">
          <div class="card-header">
            <div class="card-title">√úlke Paneli</div>
            <div class="badge" id="countryBadge">pasif</div>
          </div>
          <div class="country-name" id="countryName">Hen√ºz √ºlke se√ßilmedi</div>
          <div class="country-meta" id="countryMeta">Haritaya tƒ±klayarak bir b√∂lge se√ß.</div>

          <div class="country-stats" id="countryStats">
            <div class="stat-row">
              <span class="stat-label">Ba≈ükent</span>
              <span class="stat-value" id="capitalValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">N√ºfus</span>
              <span class="stat-value" id="populationValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">GSYƒ∞H (tahmini)</span>
              <span class="stat-value" id="gdpValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">B√∂lge</span>
              <span class="stat-value" id="regionValue">-</span>
            </div>
          </div>

          <div class="country-actions">
            <button class="mini-btn" id="btnFocus">Haritada odaklan</button>
            <button class="mini-btn" id="btnSimulate">Senaryo √ºret</button>
          </div>
        </div>

        <div class="card chat-container">
          <div class="card-header">
            <div class="card-title">AI Chat ‚Ä¢ √úlke bilgisi</div>
            <div class="badge">offline prototip</div>
          </div>
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-row">
            <input
              type="text"
              id="chatInput"
              placeholder="√úlke hakkƒ±nda soru yaz (√∂rn: 'T√ºrkiye n√ºfus')..."
            />
            <button id="chatSendBtn">G√∂nder</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- TARƒ∞H / ZAMAN Sƒ∞M√úLASYONU ----------
    const dateDisplay = document.getElementById("dateDisplay");
    const btnWeek = document.getElementById("btnWeek");
    const btnMonth = document.getElementById("btnMonth");

    const weekdaysTR = [
      "Pazar",
      "Pazartesi",
      "Salƒ±",
      "√áar≈üamba",
      "Per≈üembe",
      "Cuma",
      "Cumartesi"
    ];

    const monthsTR = [
      "Ocak",
      "≈ûubat",
      "Mart",
      "Nisan",
      "Mayƒ±s",
      "Haziran",
      "Temmuz",
      "Aƒüustos",
      "Eyl√ºl",
      "Ekim",
      "Kasƒ±m",
      "Aralƒ±k"
    ];

    const simTime = {
      date: new Date(2025, 0, 1) // 1 Ocak 2025
    };

    function formatDateTR(date) {
      const d = date.getDate();
      const m = monthsTR[date.getMonth()];
      const y = date.getFullYear();
      const weekday = weekdaysTR[date.getDay()];
      return `${d} ${m} ${y} ‚Ä¢ ${weekday}`;
    }

    function renderDate() {
      dateDisplay.textContent = formatDateTR(simTime.date);
    }

    btnWeek.addEventListener("click", () => {
      simTime.date.setDate(simTime.date.getDate() + 7);
      renderDate();
    });

    btnMonth.addEventListener("click", () => {
      simTime.date.setMonth(simTime.date.getMonth() + 1);
      renderDate();
    });

    renderDate();

    // ---------- D√úNYA HARƒ∞TASI (LEAFLET) ----------
    const map = L.map("map", {
      worldCopyJump: true
    }).setView([25, 10], 2); // D√ºnya g√∂r√ºn√ºm√º

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 6,
      minZoom: 2,
      attribution: "&copy; OpenStreetMap katkƒ±cƒ±larƒ±"
    }).addTo(map);

    let marker = null;
    const coordsLabel = document.getElementById("coordsLabel");

    // Basit √ºlke veritabanƒ± (demo i√ßin birka√ß √ºlke)
    const countriesDB = {
      TR: {
        name: "T√ºrkiye",
        capital: "Ankara",
        population: "‚âà 85 milyon",
        gdp: "‚âà 900 milyar $",
        region: "Avrupa / Orta Doƒüu",
        flavor:
          "T√ºrkiye, Avrupa ile Asya arasƒ±nda k√∂pr√º konumunda, jeopolitik √∂nemi y√ºksek bir √ºlkedir."
      },
      US: {
        name: "Amerika Birle≈üik Devletleri",
        capital: "Washington, D.C.",
        population: "‚âà 333 milyon",
        gdp: "‚âà 25 trilyon $",
        region: "Kuzey Amerika",
        flavor:
          "ABD, d√ºnyanƒ±n en b√ºy√ºk ekonomilerinden biri ve k√ºresel siyaset √ºzerinde b√ºy√ºk etkiye sahip."
      },
      DE: {
        name: "Almanya",
        capital: "Berlin",
        population: "‚âà 84 milyon",
        gdp: "‚âà 4 trilyon $",
        region: "Avrupa",
        flavor:
          "Almanya, Avrupa Birliƒüi'nin ekonomik motoru ve sanayi √ºretiminde d√ºnya √ßapƒ±nda bir merkezdir."
      },
      RU: {
        name: "Rusya",
        capital: "Moskova",
        population: "‚âà 145 milyon",
        gdp: "‚âà 1.8 trilyon $",
        region: "Avrasya",
        flavor:
          "Rusya, geni≈ü topraklarƒ± ve enerji kaynaklarƒ± ile dikkat √ßeken, tarihsel olarak b√ºy√ºk bir g√º√ß."
      },
      CN: {
        name: "√áin",
        capital: "Pekin",
        population: "‚âà 1.4 milyar",
        gdp: "‚âà 18 trilyon $",
        region: "Asya",
        flavor:
          "√áin, d√ºnyanƒ±n en kalabalƒ±k √ºlkesi ve k√ºresel ticaret aƒüƒ±nƒ±n merkezlerinden biri."
      }
    };

    const countryNameEl = document.getElementById("countryName");
    const countryMetaEl = document.getElementById("countryMeta");
    const capitalValueEl = document.getElementById("capitalValue");
    const populationValueEl = document.getElementById("populationValue");
    const gdpValueEl = document.getElementById("gdpValue");
    const regionValueEl = document.getElementById("regionValue");
    const countryBadgeEl = document.getElementById("countryBadge");
    const btnFocus = document.getElementById("btnFocus");
    const btnSimulate = document.getElementById("btnSimulate");

    const selectedCountry = {
      code: null,
      data: null,
      latlng: null
    };

    // √áok kaba bounding box ile √ºlke tahmini (demo)
    function detectCountryByLatLng(lat, lng) {
      // T√ºrkiye
      if (lat >= 35 && lat <= 43 && lng >= 25 && lng <= 45) {
        return "TR";
      }
      // ABD (kƒ±ta)
      if (lat >= 24 && lat <= 49 && lng >= -125 && lng <= -66) {
        return "US";
      }
      // Almanya
      if (lat >= 47 && lat <= 55 && lng >= 5 && lng <= 16) {
        return "DE";
      }
      // Rusya (√ßok kaba)
      if (lat >= 50 && lat <= 75 && lng >= 30 && lng <= 160) {
        return "RU";
      }
      // √áin (kabaca)
      if (lat >= 18 && lat <= 54 && lng >= 73 && lng <= 135) {
        return "CN";
      }
      return null;
    }

    function updateCountryPanel() {
      if (!selectedCountry.code || !selectedCountry.data) {
        countryNameEl.textContent = "Hen√ºz √ºlke se√ßilmedi";
        countryMetaEl.textContent = "Haritaya tƒ±klayarak bir b√∂lge se√ß.";
        capitalValueEl.textContent = "-";
        populationValueEl.textContent = "-";
        gdpValueEl.textContent = "-";
        regionValueEl.textContent = "-";
        countryBadgeEl.textContent = "pasif";
        countryBadgeEl.style.color = "#a5b4fc";
        return;
      }

      const c = selectedCountry.data;
      countryNameEl.textContent = c.name;
      countryMetaEl.textContent = c.flavor;
      capitalValueEl.textContent = c.capital;
      populationValueEl.textContent = c.population;
      gdpValueEl.textContent = c.gdp;
      regionValueEl.textContent = c.region;
      countryBadgeEl.textContent = "aktif";
      countryBadgeEl.style.color = "#4ade80";
    }

    map.on("click", (e) => {
      const { lat, lng } = e.latlng;

      if (marker) {
        marker.setLatLng(e.latlng);
      } else {
        marker = L.marker(e.latlng).addTo(map);
      }

      coordsLabel.textContent = `Lat: ${lat.toFixed(2)} ‚Ä¢ Lng: ${lng.toFixed(2)}`;

      const code = detectCountryByLatLng(lat, lng);
      selectedCountry.latlng = e.latlng;

      if (code && countriesDB[code]) {
        selectedCountry.code = code;
        selectedCountry.data = countriesDB[code];
      } else {
        selectedCountry.code = null;
        selectedCountry.data = null;
      }

      updateCountryPanel();
      addBotMessageOnCountryChange();
    });

    btnFocus.addEventListener("click", () => {
      if (selectedCountry.latlng) {
        map.setView(selectedCountry.latlng, 5);
      }
    });

    btnSimulate.addEventListener("click", () => {
      if (!selectedCountry.data) {
        addBotMessage(
          "Hen√ºz net bir √ºlke se√ßmedin. Haritadan T√ºrkiye, ABD, Almanya, Rusya veya √áin √ßevresine tƒ±klamayƒ± dene."
        );
        return;
      }
      const c = selectedCountry.data;
      const msg =
        `${c.name} i√ßin hƒ±zlƒ± bir senaryo: ${formatDateTR(simTime.date)} itibarƒ±yla ` +
        `${c.region} b√∂lgesinde jeopolitik √∂nemi y√ºksek. Ekonomi seviyesi ${c.gdp} bandƒ±nda, ` +
        `n√ºfus yakla≈üƒ±k ${c.population}. Oyun i√ßinde bu √ºlke ile diplomasi, ticaret ve askeri kararlar planlanabilir.`;
      addBotMessage(msg);
    });

    // ---------- "AI CHAT" (OFFLINE PROTOTƒ∞P) ----------
    const chatMessagesEl = document.getElementById("chatMessages");
    const chatInputEl = document.getElementById("chatInput");
    const chatSendBtn = document.getElementById("chatSendBtn");

    function addChatMessage(role, text) {
      const div = document.createElement("div");
      div.className = "chat-msg " + (role === "user" ? "me" : "bot");
      const roleSpan = document.createElement("span");
      roleSpan.className = "role";
      roleSpan.textContent = role === "user" ? "Sen: " : "AI: ";
      const textSpan = document.createElement("span");
      textSpan.className = "text";
      textSpan.textContent = text;
      div.appendChild(roleSpan);
      div.appendChild(textSpan);
      chatMessagesEl.appendChild(div);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    function addBotMessage(text) {
      addChatMessage("bot", text);
    }

    function addBotMessageOnCountryChange() {
      if (!selectedCountry.data) {
        addBotMessage("Bu koordinasyon tam olarak tanƒ±mlƒ± bir √ºlke alanƒ±na d√º≈üm√ºyor. Demo i√ßin T√ºrkiye, ABD, Almanya, Rusya veya √áin sƒ±nƒ±rlarƒ±na tƒ±klamayƒ± deneyebilirsin.");
      } else {
        const c = selectedCountry.data;
        addBotMessage(
          `${c.name} se√ßildi. Ba≈ükent: ${c.capital}. N√ºfus: ${c.population}. Kƒ±sa tanƒ±m: ${c.flavor}`
        );
      }
    }

    function generateAIResponse(input) {
      const text = input.toLowerCase();
      const c = selectedCountry.data;

      if (!c) {
        return "≈ûu anda belirli bir √ºlke se√ßilmedi. Haritadan bir √ºlke b√∂lgesine tƒ±klayƒ±p sonra tekrar sorabilirsin.";
      }

      let base = `${c.name} hakkƒ±nda kƒ±sa bir √∂zet: Ba≈ükent ${c.capital}, n√ºfus yakla≈üƒ±k ${c.population}, ` +
        `ekonomi kabaca ${c.gdp} seviyesinde ve ${c.region} b√∂lgesinde yer alƒ±yor. ${c.flavor} `;

      if (text.includes("n√ºfus")) {
        return `${c.name} i√ßin demo n√ºfus deƒüeri: ${c.population}. Ger√ßek oyunda bu sayƒ± yƒ±l yƒ±l deƒüi≈üen dinamik bir deƒüi≈üken olacak.`;
      }

      if (text.includes("ekonomi") || text.includes("gsyih") || text.includes("para")) {
        return `${c.name} ekonomisi prototipte ${c.gdp} bandƒ±nda modelleniyor. ƒ∞leride; vergi, ticaret, √ºretim ve sava≈ü kararlarƒ±n bu deƒüeri dinamik olarak deƒüi≈ütirecek.`;
      }

      if (text.includes("ba≈ükent") || text.includes("capital") || text.includes("y√∂netim")) {
        return `${c.name} i√ßin kaydedilen ba≈ükent: ${c.capital}. Olasƒ± oyun mekaniƒüi: ba≈ükenti kaybedersen ciddi istikrar ve moral cezasƒ± alƒ±rsƒ±n.`;
      }

      if (text.includes("b√∂lge") || text.includes("jeopolitik") || text.includes("konum")) {
        return `${c.name}, ${c.region} b√∂lgesinde yer alƒ±yor. Jeopolitik √∂nemi: ${c.flavor}`;
      }

      if (text.includes("senaryo") || text.includes("olay") || text.includes("event")) {
        return `√ñrnek bir olay: ${formatDateTR(simTime.date)} tarihinde ${c.name} i√ßin diplomasi krizleri, ticaret anla≈ümalarƒ± ve sƒ±nƒ±r gerginlikleri √ºretilebilir. Bu prototipte butonla basit senaryolar √ºretiyoruz.`;
      }

      return base + "Soruna √∂zel detaylƒ± model hen√ºz tam baƒülƒ± deƒüil, ama bu alan ileride ger√ßek AI API'lerine baƒülanacak.";
    }

    function handleChatSend() {
      const value = chatInputEl.value.trim();
      if (!value) return;
      addChatMessage("user", value);
      chatInputEl.value = "";
      const response = generateAIResponse(value);
      setTimeout(() => {
        addBotMessage(response);
      }, 150);
    }

    chatSendBtn.addEventListener("click", handleChatSend);
    chatInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleChatSend();
      }
    });

    // Ba≈ülangƒ±√ß mesajƒ±
    addBotMessage(
      "tarihsenaryosu_ai prototipine ho≈ü geldin. Haritadan bir √ºlke b√∂lgesine tƒ±kla, sonra saƒüdaki panelden √ºlke bilgisi ve senaryolarƒ± dene. Chat kƒ±smƒ±na 'T√ºrkiye n√ºfus', 'ekonomi durumu', 'senaryo' gibi ≈üeyler yazabilirsin."
    );
  </script>
</body>
</html>
