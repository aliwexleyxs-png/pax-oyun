<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>tarihsenaryosu_ai - D√ºnya Sim√ºlasyonu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet (d√ºnya haritasƒ± i√ßin) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      padding: 12px;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1200px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 50px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #111827;
    }

    .logo-area {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-main {
      font-weight: 700;
      font-size: 1rem;
    }

    .logo-sub {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .player-tag {
      font-size: 0.78rem;
      color: #a5b4fc;
    }

    .time-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.85rem;
    }

    .date-display {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .time-buttons {
      display: flex;
      gap: 4px;
    }

    .time-btn {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s, border-color 0.15s, transform 0.08s;
    }

    .time-btn span.icon {
      font-size: 0.9rem;
    }

    .time-btn:hover {
      border-color: #4f46e5;
      background: #111827;
      transform: translateY(-1px);
    }

    .main {
      display: flex;
      flex: 1;
      gap: 10px;
      min-height: 480px;
    }

    .left-panel {
      flex: 1.4;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #111827;
      background: #020617;
      display: flex;
      flex-direction: column;
    }

    #map {
      flex: 1;
      min-height: 380px;
    }

    .map-footer {
      padding: 6px 10px;
      font-size: 0.75rem;
      border-top: 1px solid #111827;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #020617;
    }

    .map-footer strong {
      color: #e5e7eb;
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card {
      background: #020617;
      border-radius: 12px;
      border: 1px solid #111827;
      padding: 10px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: #a5b4fc;
      background: #020617;
    }

    .country-name {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .country-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .country-stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
      font-size: 0.78rem;
      margin-bottom: 6px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .stat-label {
      color: #9ca3af;
    }

    .stat-value {
      font-weight: 500;
    }

    .country-actions {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .mini-btn {
      flex: 1;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
      color: #9ca3af;
      font-size: 0.75rem;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
    }

    .mini-btn:hover {
      border-color: #4b5563;
      background: #030712;
    }

    /* Diplomasi kartƒ± */
    .relation-label {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .relation-main {
      font-size: 0.82rem;
      margin-bottom: 6px;
    }

    .relation-main strong {
      color: #e5e7eb;
    }

    .relation-actions {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    .relation-log {
      border-radius: 8px;
      border: 1px solid #111827;
      background: #020617;
      padding: 6px;
      font-size: 0.75rem;
      max-height: 100px;
      overflow-y: auto;
      color: #9ca3af;
    }

    .relation-entry {
      margin-bottom: 4px;
    }

    /* Chat */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: 260px;
    }

    .chat-messages {
      flex: 1;
      border-radius: 8px;
      border: 1px solid #111827;
      background: #020617;
      padding: 8px;
      font-size: 0.78rem;
      overflow-y: auto;
      margin-bottom: 6px;
    }

    .chat-msg {
      margin-bottom: 4px;
    }

    .chat-msg.me {
      text-align: right;
    }

    .chat-msg span.role {
      font-weight: 600;
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .chat-msg span.text {
      display: inline-block;
      margin-top: 1px;
    }

    .chat-msg.bot span.text {
      color: #e5e7eb;
    }

    .chat-input-row {
      display: flex;
      gap: 4px;
    }

    .chat-input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
      padding: 6px 9px;
      color: #e5e7eb;
      font-size: 0.8rem;
      outline: none;
    }

    .chat-input-row input:focus {
      border-color: #4f46e5;
    }

    .chat-input-row button {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #4f46e5;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #e5e7eb;
      font-size: 0.78rem;
      cursor: pointer;
      transition: transform 0.08s, box-shadow 0.1s;
    }

    .chat-input-row button:hover {
      box-shadow: 0 8px 18px rgba(79,70,229,0.5);
      transform: translateY(-1px);
    }

    .chat-input-row button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    /* √úlke se√ßme overlay */
    .overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(3,7,18,0.98));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .overlay-inner {
      width: 100%;
      max-width: 480px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 16px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.9);
    }

    .overlay-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .overlay-sub {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }

    .overlay-row {
      margin-bottom: 10px;
    }

    .overlay-label {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .overlay-select {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.83rem;
      outline: none;
    }

    .overlay-select:focus {
      border-color: #4f46e5;
    }

    .overlay-buttons {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1px solid #1f2937;
      cursor: pointer;
      font-size: 0.85rem;
      transition: transform 0.1s, box-shadow 0.1s, border-color 0.15s, background 0.15s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #e5e7eb;
      border-color: #4f46e5;
    }

    .btn-primary:hover {
      box-shadow: 0 10px 25px rgba(79,70,229,0.45);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #020617;
      color: #e5e7eb;
    }

    .btn-secondary:hover {
      border-color: #4b5563;
      transform: translateY(-1px);
    }

    .overlay-hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 8px;
    }

    @media (max-width: 900px) {
      .main {
        flex-direction: column;
      }
      .left-panel {
        min-height: 260px;
      }
      #map {
        min-height: 260px;
      }
    }

    @media (max-width: 600px) {
      .time-controls {
        flex-direction: column;
        align-items: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- √úLKE SE√áME OVERLAY -->
    <div class="overlay" id="countryOverlay">
      <div class="overlay-inner">
        <div class="overlay-title">√úlkeni Se√ß</div>
        <div class="overlay-sub">
          Se√ßeceƒüin √ºlkenin <strong>ba≈ükanƒ± / lideri sensin.</strong><br>
          Haritada o √ºlkeye odaklanacaƒüƒ±z ve etkile≈üimler ona g√∂re √ßalƒ±≈üacak.
        </div>

        <div class="overlay-row">
          <div class="overlay-label">Ba≈ükanlƒ±ƒüƒ±nƒ± √ºstleneceƒüin √ºlke</div>
          <select id="playerCountrySelect" class="overlay-select">
            <!-- JS ile doldurulacak -->
          </select>
        </div>

        <div class="overlay-buttons">
          <button class="btn btn-primary" id="btnStartGame">Ba≈ülat</button>
          <button class="btn btn-secondary" id="btnRandomCountry">Rastgele √ºlke</button>
        </div>

        <div class="overlay-hint">
          Bu sadece prototip ‚Äî ≈üu an sƒ±nƒ±rlƒ± sayƒ±da √ºlke var. ƒ∞leride tam liste + arama eklenebilir.
        </div>
      </div>
    </div>

    <!-- √úST BAR -->
    <div class="top-bar">
      <div class="logo-area">
        <div class="logo-main">tarihsenaryosu_ai</div>
        <div class="logo-sub" id="logoSub">d√ºnya senaryosu ‚Ä¢ √ºlke se√ßilmedi</div>
        <div class="player-tag" id="playerTag">Lider: -</div>
      </div>
      <div class="time-controls">
        <div class="date-display" id="dateDisplay">
          Tarih y√ºkleniyor...
        </div>
        <div class="time-buttons">
          <button class="time-btn" id="btnWeek">
            <span class="icon">‚ñ∂</span>
            <span>+1 hafta</span>
          </button>
          <button class="time-btn" id="btnMonth">
            <span class="icon">‚ñ∂‚ñ∂</span>
            <span>+1 ay</span>
          </button>
        </div>
      </div>
    </div>

    <div class="main">
      <!-- SOL: HARƒ∞TA -->
      <div class="left-panel">
        <div id="map"></div>
        <div class="map-footer">
          <span>
            üåç Haritadan bir √ºlke se√ß. <strong>Koyu marker</strong> se√ßilen b√∂lgeyi g√∂sterir.
          </span>
          <span id="coordsLabel">Se√ßim yok</span>
        </div>
      </div>

      <!-- SAƒû: PANELLER -->
      <div class="right-panel">
        <!-- √úLKE PANELƒ∞ -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">√úlke Paneli</div>
            <div class="badge" id="countryBadge">pasif</div>
          </div>
          <div class="country-name" id="countryName">Hen√ºz √ºlke se√ßilmedi</div>
          <div class="country-meta" id="countryMeta">Haritaya tƒ±klayarak veya √ºlke panelinden se√ßim yap.</div>

          <div class="country-stats" id="countryStats">
            <div class="stat-row">
              <span class="stat-label">Ba≈ükent</span>
              <span class="stat-value" id="capitalValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">N√ºfus</span>
              <span class="stat-value" id="populationValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">GSYƒ∞H (tahmini)</span>
              <span class="stat-value" id="gdpValue">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">B√∂lge</span>
              <span class="stat-value" id="regionValue">-</span>
            </div>
          </div>

          <div class="country-actions">
            <button class="mini-btn" id="btnFocus">Haritada odaklan</button>
            <button class="mini-btn" id="btnSimulate">√úlke i√ßin senaryo</button>
          </div>
        </div>

        <!-- Dƒ∞PLOMASƒ∞ / ETKƒ∞LE≈ûƒ∞M PANELƒ∞ -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Diplomasi & Etkile≈üim</div>
            <div class="badge" id="relationBadge">oyuncu √ºlkesi: -</div>
          </div>
          <div class="relation-label">Se√ßilen d√ºnya: </div>
          <div class="relation-main" id="relationMain">
            Hen√ºz oyuncu √ºlkesi se√ßilmedi. √ñnce √ºlkeni se√ß, sonra haritadan ba≈üka bir √ºlke se√ßerek aradaki ili≈ükiyi dene.
          </div>
          <div class="relation-actions">
            <button class="mini-btn" id="btnFriendly">Dost√ßa mesaj</button>
            <button class="mini-btn" id="btnTrade">Ticaret teklifi</button>
            <button class="mini-btn" id="btnTension">Gerilimi artƒ±r</button>
          </div>
          <div class="relation-log" id="relationLog"></div>
        </div>

        <!-- CHAT PANELƒ∞ -->
        <div class="card chat-container">
          <div class="card-header">
            <div class="card-title">AI Chat ‚Ä¢ √úlke bilgisi & senaryo</div>
            <div class="badge">offline prototip</div>
          </div>
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-row">
            <input
              type="text"
              id="chatInput"
              placeholder="Soru yaz: 'benim √ºlkemin ekonomisi', 'T√ºrkiye n√ºfusu'..."
            />
            <button id="chatSendBtn">G√∂nder</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- TARƒ∞H / ZAMAN Sƒ∞M√úLASYONU ----------
    const dateDisplay = document.getElementById("dateDisplay");
    const btnWeek = document.getElementById("btnWeek");
    const btnMonth = document.getElementById("btnMonth");

    const weekdaysTR = [
      "Pazar",
      "Pazartesi",
      "Salƒ±",
      "√áar≈üamba",
      "Per≈üembe",
      "Cuma",
      "Cumartesi"
    ];

    const monthsTR = [
      "Ocak",
      "≈ûubat",
      "Mart",
      "Nisan",
      "Mayƒ±s",
      "Haziran",
      "Temmuz",
      "Aƒüustos",
      "Eyl√ºl",
      "Ekim",
      "Kasƒ±m",
      "Aralƒ±k"
    ];

    const simTime = {
      date: new Date(2025, 0, 1) // 1 Ocak 2025
    };

    function formatDateTR(date) {
      const d = date.getDate();
      const m = monthsTR[date.getMonth()];
      const y = date.getFullYear();
      const weekday = weekdaysTR[date.getDay()];
      return `${d} ${m} ${y} ‚Ä¢ ${weekday}`;
    }

    function renderDate() {
      dateDisplay.textContent = formatDateTR(simTime.date);
    }

    btnWeek.addEventListener("click", () => {
      simTime.date.setDate(simTime.date.getDate() + 7);
      renderDate();
    });

    btnMonth.addEventListener("click", () => {
      simTime.date.setMonth(simTime.date.getMonth() + 1);
      renderDate();
    });

    renderDate();

    // ---------- √úLKE VERƒ∞LERƒ∞ ----------
    // Prototip: sƒ±nƒ±rlƒ± sayƒ±da √ºlke (kolayca geni≈ületilebilir)
    const countriesDB = {
      TR: {
        code: "TR",
        name: "T√ºrkiye",
        capital: "Ankara",
        population: "‚âà 85 milyon",
        gdp: "‚âà 900 milyar $",
        region: "Avrupa / Orta Doƒüu",
        flavor:
          "T√ºrkiye, Avrupa ile Asya arasƒ±nda k√∂pr√º konumunda, jeopolitik √∂nemi y√ºksek bir √ºlkedir.",
        latlng: [39, 35]
      },
      US: {
        code: "US",
        name: "Amerika Birle≈üik Devletleri",
        capital: "Washington, D.C.",
        population: "‚âà 333 milyon",
        gdp: "‚âà 25 trilyon $",
        region: "Kuzey Amerika",
        flavor:
          "ABD, d√ºnyanƒ±n en b√ºy√ºk ekonomilerinden biri ve k√ºresel siyaset √ºzerinde b√ºy√ºk etkiye sahip.",
        latlng: [38, -97]
      },
      DE: {
        code: "DE",
        name: "Almanya",
        capital: "Berlin",
        population: "‚âà 84 milyon",
        gdp: "‚âà 4 trilyon $",
        region: "Avrupa",
        flavor:
          "Almanya, Avrupa Birliƒüi'nin ekonomik motoru ve sanayi √ºretiminde d√ºnya √ßapƒ±nda bir merkezdir.",
        latlng: [51, 10]
      },
      RU: {
        code: "RU",
        name: "Rusya",
        capital: "Moskova",
        population: "‚âà 145 milyon",
        gdp: "‚âà 1.8 trilyon $",
        region: "Avrasya",
        flavor:
          "Rusya, geni≈ü topraklarƒ± ve enerji kaynaklarƒ± ile dikkat √ßeken, tarihsel olarak b√ºy√ºk bir g√º√ß.",
        latlng: [60, 90]
      },
      CN: {
        code: "CN",
        name: "√áin",
        capital: "Pekin",
        population: "‚âà 1.4 milyar",
        gdp: "‚âà 18 trilyon $",
        region: "Asya",
        flavor:
          "√áin, d√ºnyanƒ±n en kalabalƒ±k √ºlkesi ve k√ºresel ticaret aƒüƒ±nƒ±n merkezlerinden biri.",
        latlng: [35, 103]
      },
      FR: {
        code: "FR",
        name: "Fransa",
        capital: "Paris",
        population: "‚âà 68 milyon",
        gdp: "‚âà 3 trilyon $",
        region: "Avrupa",
        flavor:
          "Fransa, k√ºlt√ºrel mirasƒ±, sanatƒ± ve diplomatik etkisiyle √∂ne √ßƒ±kan bir Avrupa √ºlkesidir.",
        latlng: [46.5, 2.5]
      },
      GB: {
        code: "GB",
        name: "Birle≈üik Krallƒ±k",
        capital: "Londra",
        population: "‚âà 67 milyon",
        gdp: "‚âà 3 trilyon $",
        region: "Avrupa",
        flavor:
          "Birle≈üik Krallƒ±k, tarihi imparatorluk ge√ßmi≈üi ve finans merkezi Londra ile √∂nemli bir k√ºresel akt√∂rd√ºr.",
        latlng: [55, -3]
      },
      BR: {
        code: "BR",
        name: "Brezilya",
        capital: "Bras√≠lia",
        population: "‚âà 215 milyon",
        gdp: "‚âà 1.6 trilyon $",
        region: "G√ºney Amerika",
        flavor:
          "Brezilya, G√ºney Amerika'nƒ±n en b√ºy√ºk √ºlkesi ve doƒüal kaynaklarƒ± ile √∂ne √ßƒ±kan bir g√º√ßt√ºr.",
        latlng: [-10, -52]
      },
      IN: {
        code: "IN",
        name: "Hindistan",
        capital: "Yeni Delhi",
        population: "‚âà 1.4 milyar",
        gdp: "‚âà 3.7 trilyon $",
        region: "Asya",
        flavor:
          "Hindistan, gen√ß n√ºfusu ve hƒ±zla b√ºy√ºyen ekonomisiyle geleceƒüin s√ºper g√º√ß adaylarƒ±ndan biridir.",
        latlng: [22, 79]
      },
      JP: {
        code: "JP",
        name: "Japonya",
        capital: "Tokyo",
        population: "‚âà 125 milyon",
        gdp: "‚âà 4.2 trilyon $",
        region: "Asya",
        flavor:
          "Japonya, teknoloji, sanayi ve pop k√ºlt√ºr√º ile d√ºnya sahnesinde √∂nemli bir yere sahiptir.",
        latlng: [36, 138]
      },
      EG: {
        code: "EG",
        name: "Mƒ±sƒ±r",
        capital: "Kahire",
        population: "‚âà 110 milyon",
        gdp: "‚âà 475 milyar $",
        region: "Afrika / Orta Doƒüu",
        flavor:
          "Mƒ±sƒ±r, Nil Nehri ve antik medeniyet mirasƒ± ile tarih boyunca stratejik bir b√∂lge olmu≈ütur.",
        latlng: [26, 30]
      }
    };

    const allCountryCodes = Object.keys(countriesDB);

    // ---------- √úLKE SE√áME OVERLAY ----------
    const overlay = document.getElementById("countryOverlay");
    const playerCountrySelect = document.getElementById("playerCountrySelect");
    const btnStartGame = document.getElementById("btnStartGame");
    const btnRandomCountry = document.getElementById("btnRandomCountry");
    const logoSub = document.getElementById("logoSub");
    const playerTag = document.getElementById("playerTag");
    const relationBadge = document.getElementById("relationBadge");

    const playerCountry = {
      code: null,
      data: null
    };

    function fillPlayerCountrySelect() {
      playerCountrySelect.innerHTML = "";
      allCountryCodes.forEach(code => {
        const c = countriesDB[code];
        const opt = document.createElement("option");
        opt.value = code;
        opt.textContent = c.name;
        playerCountrySelect.appendChild(opt);
      });
      playerCountrySelect.value = "TR"; // default T√ºrkiye
    }

    function setPlayerCountry(code) {
      const c = countriesDB[code];
      if (!c) return;
      playerCountry.code = code;
      playerCountry.data = c;
      logoSub.textContent = `d√ºnya senaryosu ‚Ä¢ oyuncu √ºlkesi: ${c.name}`;
      playerTag.textContent = `Lider: ${c.name} ba≈ükanƒ± sensin`;
      relationBadge.textContent = `oyuncu √ºlkesi: ${c.name}`;
      // haritayƒ± oyuncu √ºlkesine odakla
      if (c.latlng) {
        map.setView(c.latlng, 4);
        // se√ßilen √ºlke paneline de set edelim
        selectedCountry.code = code;
        selectedCountry.data = c;
        selectedCountry.latlng = L.latLng(c.latlng[0], c.latlng[1]);
        if (marker) {
          marker.setLatLng(selectedCountry.latlng);
        } else {
          marker = L.marker(selectedCountry.latlng).addTo(map);
        }
        updateCountryPanel();
        updateRelationText();
      }
    }

    btnStartGame.addEventListener("click", () => {
      const code = playerCountrySelect.value;
      setPlayerCountry(code);
      overlay.style.display = "none";
      addBotMessage(
        `${countriesDB[code].name} √ºlkesinin lideri olarak oyuna ba≈üladƒ±n. Haritadan ba≈üka √ºlkeleri se√ßip diplomasi ve senaryo etkile≈üimlerini deneyebilirsin.`
      );
    });

    btnRandomCountry.addEventListener("click", () => {
      const randomCode =
        allCountryCodes[Math.floor(Math.random() * allCountryCodes.length)];
      playerCountrySelect.value = randomCode;
    });

    fillPlayerCountrySelect();

    // ---------- D√úNYA HARƒ∞TASI (LEAFLET) ----------
    const map = L.map("map", {
      worldCopyJump: true
    }).setView([25, 10], 2); // D√ºnya g√∂r√ºn√ºm√º

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 6,
      minZoom: 2,
      attribution: "&copy; OpenStreetMap katkƒ±cƒ±larƒ±"
    }).addTo(map);

    let marker = null;
    const coordsLabel = document.getElementById("coordsLabel");

    // √áok kaba bounding box ile √ºlke tahmini (demo)
    function detectCountryByLatLng(lat, lng) {
      // T√ºrkiye
      if (lat >= 35 && lat <= 43 && lng >= 25 && lng <= 45) return "TR";
      // ABD (kƒ±ta)
      if (lat >= 24 && lat <= 49 && lng >= -125 && lng <= -66) return "US";
      // Almanya
      if (lat >= 47 && lat <= 55 && lng >= 5 && lng <= 16) return "DE";
      // Rusya
      if (lat >= 50 && lat <= 75 && lng >= 30 && lng <= 160) return "RU";
      // √áin
      if (lat >= 18 && lat <= 54 && lng >= 73 && lng <= 135) return "CN";
      // Brezilya
      if (lat >= -35 && lat <= 5 && lng >= -75 && lng <= -34) return "BR";
      // Hindistan
      if (lat >= 7 && lat <= 37 && lng >= 68 && lng <= 97) return "IN";
      // Japonya
      if (lat >= 30 && lat <= 46 && lng >= 129 && lng <= 146) return "JP";
      // Mƒ±sƒ±r
      if (lat >= 22 && lat <= 32 && lng >= 24 && lng <= 36) return "EG";
      // Fransa
      if (lat >= 42 && lat <= 51 && lng >= -5 && lng <= 8) return "FR";
      // Birle≈üik Krallƒ±k
      if (lat >= 50 && lat <= 59 && lng >= -8 && lng <= 2) return "GB";
      return null;
    }

    const countryNameEl = document.getElementById("countryName");
    const countryMetaEl = document.getElementById("countryMeta");
    const capitalValueEl = document.getElementById("capitalValue");
    const populationValueEl = document.getElementById("populationValue");
    const gdpValueEl = document.getElementById("gdpValue");
    const regionValueEl = document.getElementById("regionValue");
    const countryBadgeEl = document.getElementById("countryBadge");
    const btnFocus = document.getElementById("btnFocus");
    const btnSimulate = document.getElementById("btnSimulate");

    const selectedCountry = {
      code: null,
      data: null,
      latlng: null
    };

    function updateCountryPanel() {
      if (!selectedCountry.code || !selectedCountry.data) {
        countryNameEl.textContent = "Hen√ºz √ºlke se√ßilmedi";
        countryMetaEl.textContent = "Haritaya tƒ±klayarak veya √ºlke se√ßiminden bir √ºlke se√ß.";
        capitalValueEl.textContent = "-";
        populationValueEl.textContent = "-";
        gdpValueEl.textContent = "-";
        regionValueEl.textContent = "-";
        countryBadgeEl.textContent = "pasif";
        countryBadgeEl.style.color = "#a5b4fc";
        return;
      }

      const c = selectedCountry.data;
      countryNameEl.textContent = c.name;
      let meta = c.flavor;
      if (playerCountry.code && selectedCountry.code === playerCountry.code) {
        meta += " (Bu √ºlke senin kontrol√ºnde.)";
        countryBadgeEl.textContent = "senin √ºlken";
        countryBadgeEl.style.color = "#4ade80";
      } else if (playerCountry.code) {
        meta += " (Bu √ºlke ile diplomasi yapabilirsin.)";
        countryBadgeEl.textContent = "yabancƒ± √ºlke";
        countryBadgeEl.style.color = "#fbbf24";
      } else {
        countryBadgeEl.textContent = "aktif";
        countryBadgeEl.style.color = "#a5b4fc";
      }
      countryMetaEl.textContent = meta;

      capitalValueEl.textContent = c.capital;
      populationValueEl.textContent = c.population;
      gdpValueEl.textContent = c.gdp;
      regionValueEl.textContent = c.region;
    }

    map.on("click", (e) => {
      const { lat, lng } = e.latlng;

      if (marker) {
        marker.setLatLng(e.latlng);
      } else {
        marker = L.marker(e.latlng).addTo(map);
      }

      coordsLabel.textContent = `Lat: ${lat.toFixed(2)} ‚Ä¢ Lng: ${lng.toFixed(2)}`;

      const code = detectCountryByLatLng(lat, lng);
      selectedCountry.latlng = e.latlng;

      if (code && countriesDB[code]) {
        selectedCountry.code = code;
        selectedCountry.data = countriesDB[code];
      } else {
        selectedCountry.code = null;
        selectedCountry.data = null;
      }

      updateCountryPanel();
      updateRelationText();
      addBotMessageOnCountryChange();
    });

    btnFocus.addEventListener("click", () => {
      if (selectedCountry.latlng) {
        map.setView(selectedCountry.latlng, 5);
      } else if (playerCountry.data && playerCountry.data.latlng) {
        map.setView(playerCountry.data.latlng, 4);
      }
    });

    btnSimulate.addEventListener("click", () => {
      if (!selectedCountry.data) {
        addBotMessage(
          "Hen√ºz net bir √ºlke se√ßilmedi. Haritadan tanƒ±mlƒ± bir b√∂lgeye tƒ±klamayƒ± dene (T√ºrkiye, ABD, Almanya, Rusya, √áin, Brezilya, Hindistan, Japonya, Mƒ±sƒ±r, Fransa, Birle≈üik Krallƒ±k)."
        );
        return;
      }
      const c = selectedCountry.data;
      const msg =
        `${c.name} i√ßin hƒ±zlƒ± bir senaryo: ${formatDateTR(simTime.date)} itibarƒ±yla ` +
        `${c.region} b√∂lgesinde jeopolitik √∂nemi y√ºksek. Ekonomi seviyesi ${c.gdp} bandƒ±nda, ` +
        `n√ºfus yakla≈üƒ±k ${c.population}. Bu √ºlke i√ßin ileride diplomasi, ticaret ve askeri kararlar detaylƒ± olarak i≈ülenebilir.`;
      addBotMessage(msg);
    });

    // ---------- Dƒ∞PLOMASƒ∞ / ETKƒ∞LE≈ûƒ∞M ----------
    const relationMain = document.getElementById("relationMain");
    const relationLog = document.getElementById("relationLog");
    const btnFriendly = document.getElementById("btnFriendly");
    const btnTrade = document.getElementById("btnTrade");
    const btnTension = document.getElementById("btnTension");

    function addRelationEntry(text) {
      const div = document.createElement("div");
      div.className = "relation-entry";
      div.textContent = text;
      relationLog.prepend(div);
    }

    function updateRelationText() {
      if (!playerCountry.code) {
        relationMain.textContent =
          "Hen√ºz oyuncu √ºlkesi se√ßilmedi. √ñnce ba≈ülangƒ±√ß ekranƒ±ndan √ºlkeni se√ß.";
        return;
      }
      if (!selectedCountry.code || !selectedCountry.data) {
        relationMain.textContent =
          `${playerCountry.data.name} liderisin. Haritadan ba≈üka bir √ºlke se√ßtiƒüinde aradaki ili≈ükiyi burada g√∂receksin.`;
        return;
      }
      if (selectedCountry.code === playerCountry.code) {
        relationMain.innerHTML =
          `<strong>${playerCountry.data.name}</strong> kendi √ºlken. ƒ∞√ß politika, ekonomi ve ordu kararlarƒ± ileri s√ºr√ºmlerde burada ≈üekillenecek.`;
      } else {
        relationMain.innerHTML =
          `<strong>${playerCountry.data.name}</strong> ‚Üî <strong>${selectedCountry.data.name}</strong> arasƒ±ndaki ili≈üki: ` +
          `≈üu an tarafsƒ±z. A≈üaƒüƒ±daki butonlarla dost√ßa mesaj, ticaret veya gerilim etkile≈üimleri olu≈üturabilirsin.`;
      }
    }

    btnFriendly.addEventListener("click", () => {
      if (!playerCountry.code || !selectedCountry.data) {
        addRelationEntry("√ñnce bir oyuncu √ºlkesi ve haritadan bir hedef √ºlke se√ß.");
        return;
      }
      if (playerCountry.code === selectedCountry.code) {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name} i√ßinde i√ß barƒ±≈ü mesajlarƒ± yayƒ±ldƒ±. Halk memnun g√∂r√ºn√ºyor.`
        );
      } else {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name}, ${selectedCountry.data.name} y√∂netimine dost√ßa bir diplomatik mesaj g√∂nderdi.`
        );
      }
    });

    btnTrade.addEventListener("click", () => {
      if (!playerCountry.code || !selectedCountry.data) {
        addRelationEntry("√ñnce bir oyuncu √ºlkesi ve haritadan bir hedef √ºlke se√ß.");
        return;
      }
      if (playerCountry.code === selectedCountry.code) {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name} i√ß pazarƒ±nda yeni ticaret reformlarƒ± konu≈üuluyor.`
        );
      } else {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name}, ${selectedCountry.data.name} ile ticaret anla≈ümasƒ± g√∂r√º≈ümelerine ba≈üladƒ±.`
        );
      }
    });

    btnTension.addEventListener("click", () => {
      if (!playerCountry.code || !selectedCountry.data) {
        addRelationEntry("√ñnce bir oyuncu √ºlkesi ve haritadan bir hedef √ºlke se√ß.");
        return;
      }
      if (playerCountry.code === selectedCountry.code) {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name} i√ßinde i√ß siyasi gerilimler artƒ±yor; ileride bu i√ß sava≈ü riskine d√∂n√º≈üebilir.`
        );
      } else {
        addRelationEntry(
          `${formatDateTR(simTime.date)} ‚Ä¢ ${playerCountry.data.name} ile ${selectedCountry.data.name} arasƒ±nda diplomatik gerilim arttƒ±. Haber ba≈ülƒ±klarƒ± sertle≈üiyor.`
        );
      }
    });

    // ---------- "AI CHAT" (OFFLINE PROTOTƒ∞P) ----------
    const chatMessagesEl = document.getElementById("chatMessages");
    const chatInputEl = document.getElementById("chatInput");
    const chatSendBtn = document.getElementById("chatSendBtn");

    function addChatMessage(role, text) {
      const div = document.createElement("div");
      div.className = "chat-msg " + (role === "user" ? "me" : "bot");
      const roleSpan = document.createElement("span");
      roleSpan.className = "role";
      roleSpan.textContent = role === "user" ? "Sen: " : "AI: ";
      const textSpan = document.createElement("span");
      textSpan.className = "text";
      textSpan.textContent = text;
      div.appendChild(roleSpan);
      div.appendChild(textSpan);
      chatMessagesEl.appendChild(div);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    function addBotMessage(text) {
      addChatMessage("bot", text);
    }

    function addBotMessageOnCountryChange() {
      if (!selectedCountry.data) {
        addBotMessage(
          "Bu koordinasyon tam olarak tanƒ±mlƒ± bir √ºlke alanƒ±na d√º≈üm√ºyor. Demo i√ßin T√ºrkiye, ABD, Almanya, Rusya, √áin, Brezilya, Hindistan, Japonya, Mƒ±sƒ±r, Fransa veya Birle≈üik Krallƒ±k √ßevresine tƒ±klamayƒ± deneyebilirsin."
        );
      } else {
        const c = selectedCountry.data;
        addBotMessage(
          `${c.name} se√ßildi. Ba≈ükent: ${c.capital}. N√ºfus: ${c.population}. Kƒ±sa tanƒ±m: ${c.flavor}`
        );
      }
    }

    function generateAIResponse(input) {
      const text = input.toLowerCase();
      const selected = selectedCountry.data;
      const player = playerCountry.data;

      // "benim √ºlkem" ifadeleri
      if (text.includes("benim √ºlkem") || text.includes("√ºlkem") || text.includes("ba≈ükanƒ±yƒ±m")) {
        if (!player) {
          return "Hen√ºz oyuncu √ºlkesi se√ßmedin. Ba≈ülangƒ±√ß overlay ekranƒ±ndan bir √ºlke se√ßtiƒüinde 'benim √ºlkem' sorularƒ±na cevap verebilirim.";
        }
        return `${player.name} senin kontrol√ºnde. Ba≈ükent ${player.capital}, n√ºfus yakla≈üƒ±k ${player.population}, ekonomi seviyesi prototipte ${player.gdp} bandƒ±nda. B√∂lge: ${player.region}.`;
      }

      // belirli √ºlke adƒ± ge√ßerse ilgili √ºlke
      for (const code of allCountryCodes) {
        const c = countriesDB[code];
        if (text.includes(c.name.toLowerCase().split(" ")[0])) {
          return `${c.name} hakkƒ±nda kƒ±sa bir √∂zet: Ba≈ükent ${c.capital}, n√ºfus yakla≈üƒ±k ${c.population}, ekonomi kabaca ${c.gdp}, b√∂lge: ${c.region}. ${c.flavor}`;
        }
      }

      // Se√ßilmi≈ü √ºlke varsa
      if (selected) {
        const c = selected;
        if (text.includes("n√ºfus")) {
          return `${c.name} i√ßin demo n√ºfus deƒüeri: ${c.population}. Ger√ßek oyunda bu deƒüer zamanla deƒüi≈üen dinamik bir parametre olacak.`;
        }

        if (text.includes("ekonomi") || text.includes("gsyih") || text.includes("para")) {
          return `${c.name} ekonomisi bu prototipte ${c.gdp} bandƒ±nda modelleniyor. ƒ∞leride vergi, ticaret, √ºretim ve sava≈ü kararlarƒ±n bu deƒüeri dinamik olarak deƒüi≈ütirecek.`;
        }

        if (text.includes("ba≈ükent") || text.includes("capital") || text.includes("y√∂netim")) {
          return `${c.name} i√ßin kaydedilen ba≈ükent: ${c.capital}. Oyun mekaniƒüi fikri: ba≈ükenti kaybedersen istikrar ve moralde b√ºy√ºk bir d√º≈ü√º≈ü olacak.`;
        }

        if (text.includes("b√∂lge") || text.includes("jeopolitik") || text.includes("konum")) {
          return `${c.name}, ${c.region} b√∂lgesinde yer alƒ±yor. Jeopolitik √∂nemi: ${c.flavor}`;
        }

        if (text.includes("senaryo") || text.includes("olay") || text.includes("event")) {
          return `√ñrnek bir olay: ${formatDateTR(simTime.date)} tarihinde ${c.name} i√ßin diplomasi krizleri, ticaret anla≈ümalarƒ± ve sƒ±nƒ±r gerginlikleri √ºretilebilir. Prototipte butonlarla basit senaryolar deniyoruz.`;
        }

        return `${c.name} i√ßin demo bilgiler: ba≈ükent ${c.capital}, n√ºfus ${c.population}, ekonomi ${c.gdp}, b√∂lge ${c.region}. ${c.flavor}`;
      }

      // genel fallback
      if (player) {
        return `≈ûu anda ${player.name} √ºlkesinin liderisin. Haritadan ba≈üka √ºlkeleri se√ßip diplomasi paneli ve 'senaryo' butonunu deneyebilirsin. Daha spesifik bir soru sor: 'benim √ºlkemin ekonomisi', 'T√ºrkiye n√ºfusu' gibi.`;
      }

      return "Bu prototipte sƒ±nƒ±rlƒ± bir √ºlke veritabanƒ± var. √ñnce √ºlke se√ß overlay'inde bir √ºlke se√ß, sonra 'benim √ºlkem', 'T√ºrkiye n√ºfusu' gibi sorular sorabilirsin.";
    }

    function handleChatSend() {
      const value = chatInputEl.value.trim();
      if (!value) return;
      addChatMessage("user", value);
      chatInputEl.value = "";
      const response = generateAIResponse(value);
      setTimeout(() => {
        addBotMessage(response);
      }, 120);
    }

    chatSendBtn.addEventListener("click", handleChatSend);
    chatInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleChatSend();
      }
    });

    // Ba≈ülangƒ±√ß mesajƒ±
    addBotMessage(
      "tarihsenaryosu_ai d√ºnya prototipine ho≈ü geldin. √ñnce a√ßƒ±lan ekrandan bir √ºlke se√ß; b√∂ylece o √ºlkenin lideri olacaksƒ±n. Sonra haritadan ba≈üka √ºlkeleri se√ßip diplomasi panelini ve chat'i kullanabilirsin."
    );

    // ƒ∞LK DURUM
    updateCountryPanel();
    updateRelationText();
  </script>
</body>
</html>
